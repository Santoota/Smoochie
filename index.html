<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>1 Year</title>
  <meta name="description" content="Our 1-year anniversary page." />

  <style>
    @font-face{
      font-family: "Faith";
      src: url("./Faith.ttf") format("truetype");
      font-display: swap;
    }

    /* Faith font for the bottom romantic section (font-family name changed to "Faith") */
    @font-face{
      font-family: "Faith";
      src: url("./Faith") format("truetype");
      font-display: swap;
    }

    :root{
      --bg1:#0b1020;
      --bg2:#1a0f2e;
      --bg3:#2a1244;
      --card:#ffffff10;
      --card2:#ffffff14;
      --text:#f7f7fb;
      --muted:#d9d9e6cc;
      --accent:#ff77b7;
      --accent2:#7bdcff;
      --radius:22px;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: "Pastel Trunk", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: linear-gradient(135deg, #080d18 0%, #120a24 35%, #20113b 68%, #0b1020 100%);
      overflow-x:hidden;
      position:relative;
    }

    /* MP4 background */
    .bg-video-wrap{
      position:fixed;
      inset:0;
      z-index:0;
      overflow:hidden;
      pointer-events:none;
    }
    #bgVideo{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.05) contrast(1.05) brightness(0.52);
      opacity:0;
      transition: opacity .9s ease;
    }
    #bgVideo.is-ready{ opacity:1; }

    .bg-video-overlay{
      position:absolute;
      inset:0;
      background:
        radial-gradient(1200px 800px at 12% 8%, rgba(255,119,183,.20) 0%, transparent 60%),
        radial-gradient(1000px 700px at 88% 14%, rgba(123,220,255,.16) 0%, transparent 62%),
        radial-gradient(900px 700px at 55% 100%, rgba(168,85,247,.10) 0%, transparent 65%),
        linear-gradient(180deg, rgba(7,10,18,.42), rgba(7,10,18,.70));
    }

    body::before{
      content:"";
      position:fixed;
      inset:-20%;
      pointer-events:none;
      z-index:1;
      opacity:.11;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.18) 0 2px, transparent 3px),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,.14) 0 1.5px, transparent 2.5px),
        radial-gradient(circle at 60% 70%, rgba(255,255,255,.14) 0 2px, transparent 3px),
        radial-gradient(circle at 35% 85%, rgba(255,255,255,.12) 0 1.5px, transparent 2.5px);
      background-size: 240px 240px, 320px 320px, 280px 280px, 360px 360px;
      animation: starsFloat 26s linear infinite;
    }
    @keyframes starsFloat{
      from { transform: translate3d(0,0,0); }
      to   { transform: translate3d(0,-24px,0); }
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:28px 18px 70px;
      position:relative;
      z-index:10;
    }

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      position:sticky;top:0;z-index:20;
      padding:14px 10px;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(11,16,32,.72), rgba(11,16,32,.25));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      background: linear-gradient(90deg, rgba(255,119,183,.18), rgba(123,220,255,.14));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-size:13px;color:var(--muted);
      white-space:nowrap;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .btn{
      border:0;cursor:pointer;
      padding:10px 14px;border-radius:999px;
      background: linear-gradient(90deg, rgba(255,119,183,.92), rgba(123,220,255,.82));
      color:#0b1020;font-weight:800;
      box-shadow: 0 12px 35px rgba(0,0,0,.35);
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .btn:hover{transform: translateY(-1px); filter:saturate(1.05)}
    .btn:active{transform: translateY(0px) scale(.98)}

    .ghost{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;border-radius:999px;
      cursor:pointer;
      transition: transform .12s ease;
      font-weight:700;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .ghost:hover{transform: translateY(-1px)}
    .ghost:active{transform: translateY(0px) scale(.98)}

    .hero{
      margin-top:22px;
      display:grid;grid-template-columns: 1.2fr .8fr;gap:18px;
      align-items:stretch;
    }
    @media (max-width: 860px){ .hero{grid-template-columns:1fr} }

    .card{
      background: linear-gradient(180deg, var(--card), transparent 120%);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(8px);
    }

    .card-inner{padding:26px}

    .spark{
      position:absolute; inset:-2px;
      background: radial-gradient(500px 260px at 15% 10%, rgba(255,119,183,.22), transparent 70%),
                  radial-gradient(520px 260px at 85% 20%, rgba(123,220,255,.18), transparent 70%);
      pointer-events:none;
      opacity:.85;
    }

    .h1{
      font-size: clamp(30px, 4.4vw, 54px);
      line-height:1.05;margin:0 0 10px;letter-spacing:-.3px;
      text-shadow: 0 12px 30px rgba(0,0,0,.35);
    }

    .sub{
      margin:0 0 18px;
      color:var(--muted);
      font-size:16px;
      line-height:1.6;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .pills{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    .pill{
      font-size:13px;color:var(--muted);
      padding:8px 12px;border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .mini{display:grid;gap:12px}
    .mini .tile{
      padding:18px;
      background: linear-gradient(180deg, var(--card2), transparent 120%);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
    }
    .mini .k{font-weight:800;margin:0 0 6px}
    .mini .v{
      margin:0;
      color:var(--muted);
      line-height:1.55;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .section{margin-top:22px}
    .section h2{
      margin:0 0 10px;
      font-size: clamp(22px, 2.7vw, 34px);
      letter-spacing:-.2px;
    }

    /* Slider */
    .slider-card{padding:0}
    .slider-head{
      display:none !important;
      height:0 !important;
      visibility:hidden !important;
    }

    .slider{padding:14px 18px 18px}
    .track{
      display:flex;gap:14px;overflow-x:auto;
      scroll-snap-type: x mandatory;
      scroll-behavior:smooth;
      padding: 10px 2px 14px;
      -webkit-overflow-scrolling: touch;
    }
    .track::-webkit-scrollbar{height:10px}
    .track::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:999px}

    .slide{
      flex: 0 0 92%;
      scroll-snap-align: center;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      overflow:hidden;
      position:relative;
      background: rgba(0,0,0,.18);
      min-height: 360px;
      backdrop-filter: blur(4px);
    }
    @media (min-width: 860px){ .slide{flex-basis: 72%; min-height: 420px} }

    .slide img,
    .slide video{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      background:#000;
    }

    .slide img{
      transform: scale(1.02);
      filter: saturate(1.03) contrast(1.02);
    }

    .cap{
      position:absolute; left:12px; right:12px; bottom:12px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.62));
      padding:16px 14px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(8px);
      z-index:2;
      pointer-events:none;
    }

    /* video captions stay at the bottom */
    .cap.video-cap{
      top:auto;
      bottom:12px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.62));
      padding:16px 14px 12px;
    }

    .cap .t{margin:0;font-weight:900}
    .cap .d{
      margin:4px 0 0;color:rgba(255,255,255,.85);font-size:13px;line-height:1.35;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .dots{
      display:flex;gap:10px;justify-content:center;align-items:center;
      padding: 16px 0 18px;
      position:relative;
      --line-pos: 0px;
      --line-width: 0px;
    }
    .dots::before{
      content: '';
      position: absolute;
      bottom: 14px;
      left: var(--line-pos, 50%);
      width: var(--line-width, 0px);
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(184, 74, 111, 0.8), rgba(74, 138, 204, 0.8), transparent);
      box-shadow: 0 0 15px rgba(184, 74, 111, 0.6), 0 0 25px rgba(74, 138, 204, 0.4);
      transform: translateX(-50%);
      transition: all .5s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: none;
      z-index: 10;
    }

    .dot{
      width:24px;height:24px;border-radius:99px;
      background: rgba(255,255,255,.22);
      border:2px solid rgba(255,255,255,.45);
      cursor:pointer;
      transition: all .5s cubic-bezier(0.34, 1.56, 0.64, 1);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 25px rgba(0,0,0,.4), 0 2px 8px rgba(255,255,255,.15), inset 0 1px 3px rgba(255,255,255,.2);
      opacity: 0.75;
      position: relative;
      z-index: 1;
    }
    @keyframes dotFadeInOut{
      0%{ opacity: 0.75; transform: scale(1); }
      50%{ opacity: 0.4; transform: scale(0.95); }
      100%{ opacity: 0.75; transform: scale(1); }
    }
    .dot.active{
      animation: dotFadeInOut .4s ease forwards;
      background: linear-gradient(135deg, rgba(184, 74, 111, 0.95), rgba(74, 138, 204, 0.95));
      border-color: rgba(255,255,255,.7);
      transform: scale(1.3);
      box-shadow: 0 12px 40px rgba(184, 74, 111, 0.9), 0 4px 12px rgba(74, 138, 204, 0.7), inset 0 2px 6px rgba(255,255,255,.5), 0 0 60px rgba(184, 74, 111, 0.5);
      backdrop-filter: blur(25px);
      opacity: 1;
    }

    /* Hearts */
    .hearts{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:15;
    }
    .heart{
      position:absolute;
      opacity:.22;
      animation: floatUp linear forwards;
      will-change: transform, opacity;
      user-select:none;
      font-family: "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif;
      filter: drop-shadow(0 0 16px rgba(255,119,183,.22));
    }
    @keyframes floatUp{
      from{ transform: translate(var(--dx, 0px), 20px) rotate(0deg); opacity:0; }
      10%{ opacity:.22; }
      to{ transform: translate(var(--dx, 0px), -120vh) rotate(var(--rot, 10deg)); opacity:0; }
    }

    footer{
      margin-top:0;
      color:var(--muted);
      font-size:13px;
      text-align:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .img-err{
      height:100%;
      display:grid;
      place-items:center;
      padding:20px;
      text-align:center;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .img-err .big{font-weight:900;margin-bottom:6px}
    .img-err .path{opacity:.8;font-size:13px;word-break:break-all}

    /* Elegant romantic bottom section */
    .faith-part{
      margin-top: 18px;
      padding: 18px 10px 6px;
      position: relative;
    }

    .faith-part::before{
      content:"";
      display:block;
      width:min(220px, 55%);
      height:1px;
      margin: 0 auto 16px;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255,255,255,.25),
        rgba(255,119,183,.45),
        rgba(123,220,255,.45),
        rgba(255,255,255,.25),
        transparent
      );
      box-shadow: 0 0 18px rgba(255,119,183,.18);
    }

    .faith-part .faith-script{
      font-family: "Faith", cursive !important;
      text-shadow: 0 6px 20px rgba(0,0,0,.28);
      letter-spacing: .2px;
    }

    .faith-part .faith-section-title{
      text-align:center;
      margin: 0 0 6px;
      font-size: clamp(26px, 3.4vw, 40px);
      line-height: 1.15;
    }

    .faith-part .faith-closing{
      text-align:center;
      margin: 0 auto;
      max-width: 820px;
      color: rgba(247,247,251,.92);
      font-size: clamp(18px, 2.1vw, 24px);
      line-height: 1.35;
    }

    .faith-part .faith-promise{
      margin: 22px auto 12px;
      text-align:center;
      font-size: clamp(24px, 3vw, 34px);
      line-height: 1.2;
      max-width: 900px;
      color: rgba(255,255,255,.98);
    }

    .faith-part .faith-poem{
      margin: 10px auto 14px;
      max-width: 860px;
      text-align:center;
      font-size: 17px;
      line-height: 1.9;
      color: rgba(217,217,230,.94);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      text-wrap: pretty;
    }

    .faith-part .faith-poem-wrap{
      position: relative;
      margin: 8px auto 0;
      padding: 14px 16px 6px;
      max-width: 940px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.015));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 12px 34px rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }

    .faith-part .faith-footer{
      margin-top: 12px;
      text-align:center;
      color: rgba(217,217,230,.85);
      font-size: 14px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      letter-spacing: .2px;
    }

    @media (max-width: 640px){
      .faith-part .faith-poem{
        font-size: 15.5px;
        line-height: 1.8;
      }
      .faith-part .faith-poem-wrap{
        padding: 12px 12px 4px;
        border-radius: 14px;
      }
    }
  </style>
</head>

<body>
  <!-- MP4 background layer -->
  <div class="bg-video-wrap" aria-hidden="true">
    <video id="bgVideo" autoplay muted loop playsinline preload="auto">
      <source src="./background.mp4" type="video/mp4" />
    </video>
    <div class="bg-video-overlay"></div>
  </div>

  <div class="hearts" id="hearts" aria-hidden="true"></div>

  <!-- Background song -->
  <audio id="bgMusic" loop preload="auto" playsinline>
    <source src="./Lauv - Steal The Show.mp3" type="audio/mpeg" />
  </audio>

  <div class="topbar">
    <div class="brand">
      <div style="font-size:18px">üíñ</div>
      <!-- Removed: Cristian & Daniela line -->
      <div class="badge" id="badge">Loading‚Ä¶</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="ghost" id="toggleHearts" type="button">Hearts: On</button>
      <button class="ghost" id="toggleMusic" type="button">Music: Auto</button>
      <button class="btn" id="scrollToPhotos" type="button">Go to Photos</button>
    </div>
  </div>

  <main class="wrap">
    <section class="hero">
      <div class="card">
        <div class="spark"></div>
        <div class="card-inner">
          <h1 class="h1" id="title">Happy 1 Year ‚ú®</h1>

          <p class="sub" id="subtitle">
            One year of us ‚Äî the laughs, the late nights, the little moments that became everything.
          </p>

          <div class="pills">
            <div class="pill">üìÖ <span id="annivDateText">February 25, 2025</span></div>
            <div class="pill">‚è≥ <span id="daysText">0 days</span></div>
            <div class="pill">ü´∂ <span id="lineText">One year, infinite memories</span></div>
          </div>

          <div style="margin-top:18px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" id="play" type="button">‚ñ∂ Auto-Play Photos</button>
            <button class="ghost" id="pause" type="button">‚è∏ Pause</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-inner mini">
          <div class="tile">
            <p class="k">A short note</p>
            <p class="v" id="note">
              One year later and I still get that stupid-happy smile because of you.
            </p>
          </div>

          <div class="tile">
            <p class="k">Our promise</p>
            <p class="v" id="promise">
              More adventures, more patience, more laughs ‚Äî and yes, I‚Äôll still hold your hand in public.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="photos">
      <h2>Memory Roll</h2>

      <div class="card slider-card section" style="margin-top:14px">
        <div class="slider-head">
          <button class="ghost" id="prev" type="button">‚Üê Prev</button>
          <button class="ghost" id="next" type="button">Next ‚Üí</button>
        </div>

        <div class="slider">
          <div class="track" id="track" aria-label="Photo slider"></div>
        </div>
        <div class="dots" id="dots" aria-label="Slide navigation"></div>
      </div>
    </section>

    <!-- Elegant bottom section -->
    <div class="faith-part">
      <section class="section" style="margin-top:8px">
        <h2 class="faith-script faith-section-title">One year down‚Ä¶</h2>
        <p id="closing" class="faith-script faith-closing">‚Ä¶a lifetime to go. Same team, same love, forever.</p>
      </section>

      <p class="faith-script faith-promise">
        My sole promise is to be yours now and forever üíñ‚ú®
      </p>

      <div class="faith-poem-wrap">
        <p class="faith-poem">
          Some nights the distance is loud, and I cry into the dark,<br>
          missing your hands, your voice, the calm inside my heart.<br>
          We‚Äôve had our ups and downs, our storms we had to face<br>
          yet every fall reminds me you‚Äôre still my safest place.<br><br>
          So we hold on through the hard, one ‚Äúgoodnight‚Äù at a time,<br>
          turning miles into a promise, turning pain into a sign:<br>
          the happiness is coming‚Äîsoft, steady, and true,<br>
          and every road leads forward‚Ä¶ until I‚Äôm next to you. üíñ
        </p>
      </div>

      <footer class="faith-footer">Made with love ‚ù§Ô∏è</footer>
    </div>
  </main>

  <script>
    const $ = (s) => document.querySelector(s);

    // MP4 background fade-in
    const bgVideoEl = $("#bgVideo");
    if (bgVideoEl) {
      const revealBg = () => bgVideoEl.classList.add("is-ready");
      bgVideoEl.addEventListener("canplay", revealBg, { once:true });
      bgVideoEl.addEventListener("loadeddata", revealBg, { once:true });
      bgVideoEl.addEventListener("error", () => {
        // fallback gradient remains visible
      });
    }

    // Music
    const bgMusic = $("#bgMusic");
    const toggleMusicBtn = $("#toggleMusic");
    let musicStarted = false;
    let musicEnabled = true;

    function updateMusicButton(){
      if (!toggleMusicBtn) return;
      if (!musicEnabled) {
        toggleMusicBtn.textContent = "Music: Off";
      } else if (bgMusic && !bgMusic.paused) {
        toggleMusicBtn.textContent = "Music: On";
      } else if (musicStarted) {
        toggleMusicBtn.textContent = "Music: Paused";
      } else {
        toggleMusicBtn.textContent = "Music: Auto";
      }
    }

    async function startMusicOnce(){
      if (!bgMusic || !musicEnabled) return;
      if (!bgMusic.paused) {
        musicStarted = true;
        updateMusicButton();
        return;
      }

      try {
        bgMusic.volume = 0.35;
        await bgMusic.play();
        musicStarted = true;
        updateMusicButton();
      } catch (e) {
        updateMusicButton();
      }
    }

    const CONFIG = {
      oneYearAnniversary: "2025-02-25",
      relationshipStart: "2024-02-25",

      subtitle: "One year of us ‚Äî the laughs, the late nights, the little moments that became everything.",
      line: "One year, infinite memories",

      note: "One year later and I still get that stupid-happy smile because of you.",
      promise: "More adventures, more patience, more laughs ‚Äî and yes, I‚Äôll still hold your hand in public.",
      closing: "‚Ä¶a lifetime to go. Same team, same love, forever.",

      slides: [
        { src: "./IMG1.JPEG", title: "Proof we‚Äôre adorable", desc: "Day 1: I fell. Day 365: still falling. (Send help‚Ä¶ or kisses.)" },
        { src: "./IMG2.JPEG", title: "Main character energy", desc: "You + me = rom-com vibes with zero commercial breaks." },
        { src: "./IMG3.JPEG", title: "Certified chaos, politely", desc: "We‚Äôre the kind of love that laughs mid-argument and forgets why we started." },
        { src: "./IMG4.JPEG", title: "Auntie mode: unlocked", desc: "Watching you play with your nephew was my favorite kind of beautiful‚Äîpure joy, big smiles, and the sweetest heart in the room." },
        { src: "./IMG5.JPEG", title: "Steal my shirt, steal my heart", desc: "You took my shirt‚Ä¶ I took the hint. Now you have both." },
        { src: "./IMG6.JPEG", title: "One year down, forever loading‚Ä¶", desc: "Same vibe: you, me, and a lifetime of ‚Äòlook at us‚Äô moments." },
        { src: "./IMG7.JPEG", title: "Floor nap, cat approved", desc: "You fell asleep on the floor, the cat clocked in as your tiny bodyguard, and somehow it became the cutest scene I‚Äôve ever seen." },

        /* videos */
        { src: "./VID1.MP4", type: "video", title: "Pillow storm warning", desc: "One couch pillow, one dramatic wind blast, and one very adorable menace. I swear even chaos looks soft when it‚Äôs you." },
        { src: "./VID2.MP4", type: "video", title: "Sad face, soft heart", desc: "She tried the serious/sad face‚Ä¶ but we all knew the truth: she absolutely adores him. 0% fooled us, 100% stole our hearts." }
      ],

      autoplayMs: 3200
    };

    const track = $("#track");
    const dots = $("#dots");
    const heartsLayer = $("#hearts");

    let slides = [...CONFIG.slides];
    let autoplayTimer = null;
    let heartsOn = true;

    const msDay = 1000 * 60 * 60 * 24;

    function fmtDate(iso){
      const d = new Date(iso + "T00:00:00");
      return d.toLocaleDateString(undefined, { year:"numeric", month:"long", day:"numeric" });
    }

    function setText(){
      $("#subtitle").textContent = CONFIG.subtitle;
      $("#lineText").textContent = CONFIG.line;
      $("#note").textContent = CONFIG.note;
      $("#promise").textContent = CONFIG.promise;
      $("#closing").textContent = CONFIG.closing;

      $("#annivDateText").textContent = fmtDate(CONFIG.oneYearAnniversary);

      const start = new Date(CONFIG.relationshipStart + "T00:00:00");
      $("#badge").textContent = "Together since " + start.toLocaleDateString(undefined, { month:"short", year:"numeric" });

      const oneYear = new Date(CONFIG.oneYearAnniversary + "T00:00:00");
      const now = new Date();

      const firstYearDays = Math.round((oneYear - start) / msDay);
      const elapsedDays = Math.max(0, Math.floor((now - start) / msDay));
      const shownDays = Math.min(elapsedDays, firstYearDays);

      $("#daysText").textContent = shownDays + " days of us";
    }

    function clearChildren(el){ while(el.firstChild) el.removeChild(el.firstChild); }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function inferMediaType(slide){
      if (slide?.type) return String(slide.type).toLowerCase();
      const src = String(slide?.src || "").toLowerCase();
      return /\.(mp4|webm|ogg|mov|m4v)(\?|#|$)/.test(src) ? "video" : "image";
    }

    function getVideoMime(src){
      const ext = (String(src).split("?")[0].split("#")[0].split(".").pop() || "").toLowerCase();
      if (ext === "webm") return "video/webm";
      if (ext === "ogg" || ext === "ogv") return "video/ogg";
      if (ext === "mov") return "video/quicktime";
      return "video/mp4";
    }

    function buildImageCandidates(src){
      const set = new Set();
      const raw = String(src || "").trim();
      const add = (s) => { if (s) set.add(s); };

      add(raw);
      add("./" + raw.replace(/^\.\//, ""));
      add(raw.replace(/^\.\//, ""));
      add(raw.replace(/ /g, "%20"));
      add("./" + raw.replace(/^\.\//, "").replace(/ /g, "%20"));

      const noPrefix = raw.replace(/^\.\//, "");
      const m = noPrefix.match(/^(.*)\.([^.]+)$/);

      if (m){
        const base = m[1];
        const extRaw = m[2];
        const ext = extRaw.toLowerCase();
        const alts = new Set([extRaw, ext, extRaw.toUpperCase()]);

        if (ext === "jpeg") ["jpg","JPG","JPEG","jpeg"].forEach(e => alts.add(e));
        if (ext === "jpg") ["jpeg","JPEG","JPG","jpg"].forEach(e => alts.add(e));

        for (const e of alts){
          add(`${base}.${e}`);
          add(`./${base}.${e}`);
          add(`${base}.${e}`.replace(/ /g, "%20"));
          add(`./${base}.${e}`.replace(/ /g, "%20"));
        }
      }

      return Array.from(set);
    }

    function buildVideoCandidates(src){
      const set = new Set();
      const raw = String(src || "").trim();
      const add = (s) => { if (s) set.add(s); };

      add(raw);
      add("./" + raw.replace(/^\.\//, ""));
      add(raw.replace(/^\.\//, ""));
      add(raw.replace(/ /g, "%20"));
      add("./" + raw.replace(/^\.\//, "").replace(/ /g, "%20"));

      const noPrefix = raw.replace(/^\.\//, "");
      const m = noPrefix.match(/^(.*)\.([^.]+)$/);

      if (m){
        const base = m[1];
        const extRaw = m[2];
        const ext = extRaw.toLowerCase();
        const alts = new Set([extRaw, ext, extRaw.toUpperCase()]);

        if (ext === "mp4") ["MP4","m4v","M4V","mov","MOV"].forEach(e => alts.add(e));
        if (ext === "m4v") ["M4V","mp4","MP4"].forEach(e => alts.add(e));
        if (ext === "mov") ["MOV","mp4","MP4"].forEach(e => alts.add(e));
        if (ext === "webm") ["WEBM","mp4","MP4"].forEach(e => alts.add(e));

        for (const e of alts){
          add(`${base}.${e}`);
          add(`./${base}.${e}`);
          add(`${base}.${e}`.replace(/ /g, "%20"));
          add(`./${base}.${e}`.replace(/ /g, "%20"));
        }
      }

      return Array.from(set);
    }

    function applyVideoVolume(videoEl){
      try { videoEl.volume = 0.25; } catch(e) {}
    }

    function createVideoElement(slide, card){
      const video = document.createElement("video");
      video.controls = true;
      video.preload = "metadata";
      video.loop = true;
      video.playsInline = true;
      video.setAttribute("playsinline", "");
      video.setAttribute("webkit-playsinline", "");

      video.muted = false;
      applyVideoVolume(video);

      const candidates = buildVideoCandidates(slide.src);
      let idx = 0;
      let loadedOk = false;
      let timeoutId = null;
      let trying = false;

      const cleanupTimeout = () => {
        if (timeoutId) {
          clearTimeout(timeoutId);
          timeoutId = null;
        }
      };

      function showVideoError(){
        cleanupTimeout();
        card.innerHTML = `
          <div class="img-err">
            <div>
              <div class="big">Video not found / unsupported</div>
              <div class="path">${escapeHtml(String(slide.src))}</div>
              <div class="path" style="margin-top:8px;opacity:.7">If the file exists, it may need H.264/AAC encoding.</div>
            </div>
          </div>
        `;
      }

      function tryNextVideo(){
        if (trying) return;
        trying = true;

        cleanupTimeout();

        if (loadedOk) {
          trying = false;
          return;
        }

        if (idx >= candidates.length){
          trying = false;
          showVideoError();
          return;
        }

        const candidate = candidates[idx++];

        try { video.pause(); } catch(e) {}
        video.removeAttribute("src");
        while (video.firstChild) video.removeChild(video.firstChild);

        const source = document.createElement("source");
        source.src = candidate;
        source.type = getVideoMime(candidate);

        source.onerror = () => {
          if (!loadedOk) {
            trying = false;
            tryNextVideo();
          }
        };

        video.appendChild(source);

        try {
          video.load();
        } catch (e) {
          trying = false;
          tryNextVideo();
          return;
        }

        // Hosting can be slower; retry only on real error/no source
        timeoutId = setTimeout(() => {
          if (loadedOk) return;
          const noSource = video.networkState === HTMLMediaElement.NETWORK_NO_SOURCE;
          if (video.error || noSource) {
            trying = false;
            tryNextVideo();
            return;
          }
          trying = false;
        }, 12000);

        trying = false;
      }

      video.addEventListener("loadedmetadata", () => {
        loadedOk = true;
        cleanupTimeout();
        applyVideoVolume(video);
      });

      video.addEventListener("loadeddata", () => {
        loadedOk = true;
        cleanupTimeout();
        applyVideoVolume(video);
      });

      video.addEventListener("canplay", () => {
        loadedOk = true;
        cleanupTimeout();
      });

      video.addEventListener("play", () => applyVideoVolume(video));

      video.addEventListener("error", () => {
        if (!loadedOk) tryNextVideo();
      });

      tryNextVideo();
      return video;
    }

    function createImageElement(slide, index, card){
      const img = document.createElement("img");
      img.loading = "lazy";
      img.alt = slide.title || ("Photo " + (index+1));

      const candidates = buildImageCandidates(slide.src);
      let i = 0;

      function tryNextImage(){
        if (i >= candidates.length){
          card.innerHTML = `
            <div class="img-err">
              <div>
                <div class="big">Image not found</div>
                <div class="path">${escapeHtml(String(slide.src))}</div>
              </div>
            </div>
          `;
          return;
        }
        img.src = candidates[i++];
      }

      img.onerror = tryNextImage;
      tryNextImage();
      return img;
    }

    function createMediaElement(slide, index, card){
      return inferMediaType(slide) === "video"
        ? createVideoElement(slide, card)
        : createImageElement(slide, index, card);
    }

    function createSlideCard(slide, index){
      const card = document.createElement("div");
      card.className = "slide";
      card.setAttribute("data-index", String(index));

      const mediaEl = createMediaElement(slide, index, card);

      if (card.children.length === 0) {
        card.appendChild(mediaEl);

        const cap = document.createElement("div");
        cap.className = "cap" + (inferMediaType(slide) === "video" ? " video-cap" : "");
        cap.innerHTML = `
          <p class="t">${escapeHtml(slide.title || "Memory " + (index+1))}</p>
          <p class="d">${escapeHtml(slide.desc || "")}</p>
        `;
        card.appendChild(cap);
      }

      return card;
    }

    function pauseAllVideosExcept(indexToKeep = -1){
      const cards = [...track.querySelectorAll(".slide")];
      cards.forEach((card, i) => {
        if (i === indexToKeep) return;
        const v = card.querySelector("video");
        if (v && !v.paused) v.pause();
      });
    }

    function render(){
      clearChildren(track);
      clearChildren(dots);

      slides.forEach((s, idx) => track.appendChild(createSlideCard(s, idx)));

      slides.forEach((_, idx) => {
        const dot = document.createElement("button");
        dot.className = "dot" + (idx===0 ? " active" : "");
        dot.type = "button";
        dot.title = "Go to slide " + (idx+1);
        dot.addEventListener("click", () => scrollToIndex(idx));
        dots.appendChild(dot);
      });

      requestAnimationFrame(() => scrollToIndex(0, true));
    }

    function getCurrentIndex(){
      const rect = track.getBoundingClientRect();
      const centerX = rect.left + rect.width/2;

      const cards = [...track.querySelectorAll(".slide")];
      let best = 0, bestDist = Infinity;
      cards.forEach((c, idx) => {
        const r = c.getBoundingClientRect();
        const cx = r.left + r.width/2;
        const dist = Math.abs(cx - centerX);
        if (dist < bestDist){ bestDist = dist; best = idx; }
      });
      return best;
    }

    function setActiveDot(idx){
      [...dots.children].forEach((d, i) => d.classList.toggle("active", i === idx));

      const activeDot = dots.children[idx];
      if(activeDot){
        const dotsRect = dots.getBoundingClientRect();
        const dotRect = activeDot.getBoundingClientRect();
        const dotCenterPos = dotRect.left - dotsRect.left + dotRect.width / 2;
        const lineWidth = Math.min(dotRect.width * 1.8, 40);

        dots.style.setProperty('--line-pos', dotCenterPos + 'px');
        dots.style.setProperty('--line-width', lineWidth + 'px');
      }
    }

    function scrollToIndex(idx, instant=false){
      const cards = track.querySelectorAll(".slide");
      if(!cards[idx]) return;
      const behavior = instant ? "auto" : "smooth";
      cards[idx].scrollIntoView({ behavior, inline:"center", block:"nearest" });
      setActiveDot(idx);
      pauseAllVideosExcept(idx);
    }

    function next(){
      const idx = getCurrentIndex();
      scrollToIndex((idx + 1) % slides.length);
    }

    function prev(){
      const idx = getCurrentIndex();
      scrollToIndex((idx - 1 + slides.length) % slides.length);
    }

    function play(){
      stop();
      autoplayTimer = setInterval(next, CONFIG.autoplayMs);
      $("#play").textContent = "‚úÖ Auto-Play On";
    }

    function stop(){
      if(autoplayTimer){ clearInterval(autoplayTimer); autoplayTimer = null; }
      $("#play").textContent = "‚ñ∂ Auto-Play Photos";
    }

    let raf = null;
    track.addEventListener("scroll", () => {
      if(raf) return;
      raf = requestAnimationFrame(() => {
        const current = getCurrentIndex();
        setActiveDot(current);
        pauseAllVideosExcept(current);
        raf = null;
      });
    });

    $("#next").addEventListener("click", next);
    $("#prev").addEventListener("click", prev);
    $("#play").addEventListener("click", play);
    $("#pause").addEventListener("click", stop);
    $("#scrollToPhotos").addEventListener("click", () => $("#photos").scrollIntoView({behavior:"smooth"}));

    ["click", "touchstart", "keydown"].forEach(evt => {
      document.addEventListener(evt, startMusicOnce, { passive: true });
    });

    if (toggleMusicBtn) {
      toggleMusicBtn.addEventListener("click", async () => {
        if (!bgMusic) return;

        if (!bgMusic.paused) {
          musicEnabled = false;
          bgMusic.pause();
          updateMusicButton();
          return;
        }

        musicEnabled = true;
        try {
          bgMusic.volume = 0.35;
          await bgMusic.play();
          musicStarted = true;
        } catch (e) {}
        updateMusicButton();
      });
    }

    function spawnHeart(){
      if(!heartsOn) return;

      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = "üíñ";

      const left = Math.random() * 100;
      const size = 12 + Math.random() * 22;
      const dur  = 4 + Math.random() * 7;

      const dx = (Math.random() * 60 - 30).toFixed(0) + "px";
      const rot = (Math.random() * 30 - 15).toFixed(0) + "deg";

      h.style.left = left + "vw";
      h.style.bottom = "-30px";
      h.style.fontSize = size + "px";
      h.style.lineHeight = "1";
      h.style.animationDuration = dur + "s";
      h.style.opacity = (0.10 + Math.random() * 0.28).toFixed(2);
      h.style.setProperty("--dx", dx);
      h.style.setProperty("--rot", rot);

      heartsLayer.appendChild(h);
      setTimeout(() => h.remove(), dur * 1000 + 300);
    }

    setInterval(() => {
      spawnHeart();
      if(Math.random() > 0.55) spawnHeart();
    }, 110);

    $("#toggleHearts").addEventListener("click", () => {
      heartsOn = !heartsOn;
      $("#toggleHearts").textContent = "Hearts: " + (heartsOn ? "On" : "Off");
      if(!heartsOn) clearChildren(heartsLayer);
    });

    setText();
    render();
    updateMusicButton();
  </script>
</body>
</html>
